<html>
<head>
<title>Test site</title>
<style>
body {
 margin: 0;
}

.root {
 background: #2ea5ff;
 font-size: 32px;
 padding: 12px;
 display: flex;
 justify-content: center;
 align-items: center;
}
 
 .btns {
  display: flex;
  flex-direction: column;
 }
 
 .btns > button {
  margin: 8px;
  padding: 6px;
 }
</style>
</head>
<body>
<div class="root">Test test test</div>
 <div class="btns"> 
  <button id="btnA">CLICK AAA</button>
  <button id="btnB">CLICK BBB</button>
  <a href="/page">Go another page</a>
 </div>

<!-- Top.Mail.Ru counter -->
<!-- <script type="text/javascript">
var _tmr = window._tmr || (window._tmr = []);
_tmr.push({id: "3331325", type: "pageView", ecommerce: "dataLayer8dcfasdcfra", start: (new Date()).getTime(), pid: "USER_ID"});
(function (d, w, id) {
  if (d.getElementById(id)) return;
  var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true; ts.id = id;
  ts.src = "https://top-fwz1.mail.ru/js/code.js";
  var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
  if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
})(document, window, "tmr-code");
</script>
<noscript><div><img src="https://top-fwz1.mail.ru/counter?id=3331325;js=na" style="position:absolute;left:-9999px;" alt="Top.Mail.Ru" /></div></noscript> -->
<!-- /Top.Mail.Ru counter -->
 
 <!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
   ym(93609570, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/93609570" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
 
 <script>
  btnA.addEventListener('click', () => {
   _tmr.push({ type: 'reachGoal', id: 3331325, value: 123, goal: 'AAA'});
   console.log('OK');
  });
  
   btnB.addEventListener('click', () => {
   _tmr.push({ type: 'reachGoal', id: 3331325, value: 123, goal: 'BBB'});
   console.log('OK');
  });
  
  window.addEventListener('message', messageHandler);
  
  let origin;
  
  window.addEventListener('load', (event) => {
      window.opener.postMessage({type: 'READY'}, 'http://localhost');
  });
  
  function messageHandler(event) {
   try {
      const {type, data} = event.data;
      console.log(type);
      if (type === 'CREATE_FORM') {
//           createControls();
          eval(data);
          origin = data;
      }
   } catch(e) {
      console.log(event);
   }
  }
  
  function createControls() {
      const container = document.createElement('div');
      container.style.width = '100px';
      container.style.height = '100px';
      container.style.background = 'red';
      container.textContent = 'FORM';
      container.addEventListener('click', (e) => {
            window.opener.postMessage({a: 333});
      });
      document.body.appendChild(container);
  }

    const getRand = (from, to) => to - Math.round(Math.random() * (to - from))

  function appendDiv(n) {
   const x = getRand(0, window.innerWidth - 200)
   const y = getRand(0, window.innerHeight - 200)
   const w = getRand(50, 180)
   const h = getRand(20, 100)

   const div = document.createElement('div')
   div.style.width = w + 'px'
   div.style.height = h + 'px'
   div.style.top = x + 'px'
   div.style.left = y + 'px'
   div.style.position = 'fixed'
   div.style.border = `${getRand(1, 4)}px solid red`
   const btn = document.createElement(n ? 'div' : 'button');
   btn.append(document.createTextNode(n || `block_${getRand(10000, 100000)}`))
   div.appendChild(btn)

   document.body.appendChild(div)
  }

  document.addEventListener('keydown', ({code}) => {
   if (code === 'KeyQ') {
    appendDiv()
   }

   if (code === 'KeyE') {
    appendDiv(getRand(10000, 100000))
   }
  })

 </script>
</body>
</html>
